<div class="nested-fields bg-gray-100 p-4 rounded-lg mb-4">
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
    <div>
      <%= f.label :name, class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_field :name, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50" %>
    </div>
    <div>
      <%= f.label :recipe, class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_area :recipe, rows: 3, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50" %>
    </div>
  </div>

  <div class="mt-4">
    <h5 class="text-md font-semibold text-gray-900 mb-2">Ingredients</h5>
    <div id="ingredients" class="space-y-2">
      <%= f.fields_for :ingredients do |ingredient_form| %>
        <%= render 'ingredient_fields', f: ingredient_form %>
      <% end %>
      <%= link_to_add_association 'Add Ingredient', f, :ingredients, 
          class: "inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",
          data: { association_insertion_node: '#ingredients', association_insertion_method: 'append' } %>
    </div>
  </div>

  <%= link_to_remove_association "Remove Meal", f, class: "mt-4 inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" %>
</div>
